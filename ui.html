<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 16px; }
    #result { white-space: pre-wrap; background: #f2f2f2; padding: 12px; margin-top: 12px; height: 200px; overflow-y: auto; }
    button { padding: 8px 16px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>ğŸ¤ Analyze Meeting</h2>
  <button id="openBtn">Open Recorder</button>
  <div id="result">â³ Waiting for result...</div>

  <script>
  const openBtn = document.getElementById('openBtn');
  const resultBox = document.getElementById('result');
  let recorderWindow = null;
  let ready = false;

  // ğŸ‘† ç‚¹å‡»æ‰“å¼€ recorder.html
  openBtn.onclick = () => {
    recorderWindow = window.open(
      'https://fyp-2025-kath.vercel.app/record.html',
      '_blank',
      'width=500,height=400'
    );
    console.log("âœ… Recorder window opened");
  };

  // ğŸ‘‚ ç›‘å¬æ‰€æœ‰æ¥è‡ª record.html çš„æ¶ˆæ¯
  window.addEventListener('message', (event) => {
    const msg = event.data;

    // âœ… Recorder é¡µé¢å‡†å¤‡å¥½äº†
    if (msg?.type === 'ready-to-record') {
      console.log('âœ… Recorder ready, sending start signal...');
      ready = true;
      recorderWindow?.postMessage({ type: 'start-recording' }, '*');
    }

    // âœ… æ”¶åˆ°åˆ†æç»“æœ
    if (msg?.pluginMessage?.type === 'analyze-transcript') {
      const { transcript, summary } = msg.pluginMessage;
      console.log('ğŸ“¥ Received transcript & summary');
      resultBox.textContent = `ğŸ“ Transcript:\n${transcript}\n\nğŸ§  Summary:\n${summary}`;

      // è½¬å‘ç»™ code.ts æ’ä»¶ä¸»çº¿ç¨‹
      parent.postMessage({
        pluginMessage: {
          type: 'analyze-transcript',
          transcript,
          summary
        }
      }, '*');
    }
  });
</script>
 
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 16px; }
    #result { white-space: pre-wrap; background: #f2f2f2; padding: 12px; margin-top: 12px; height: 200px; overflow-y: auto; }
    button { padding: 8px 16px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>ğŸ¤ Analyze Meeting</h2>
  <button id="openBtn">Open Recorder</button>
  <div id="result">â³ Waiting for result...</div>

  <script>
    const openBtn = document.getElementById('openBtn');
    const resultBox = document.getElementById('result');
    let recorderWindow = null;
    // ç‚¹å‡»æ‰“å¼€æ–°çª—å£
    openBtn.onclick = () => {
      recorderWindow = window.open('https://fyp-2025-kath.vercel.app/record.html', '_blank', 'width=500,height=400');
      console.log("window opened");
    };

    // ç­‰çª—å£æ‰“å¼€åï¼Œå‘æ¶ˆæ¯ç»™å®ƒ
  const trySendMessage = () => {
    if (recorderWindow) {
      recorderWindow.postMessage({ type: 'start-recording' }, '*');
    } else {
      console.warn("âš ï¸ Recorder window not ready yet.");
    }
  };

  // å°è¯•å¤šæ¬¡å‘é€ï¼Œé¿å…çª—å£æœªåŠ è½½å®Œæ¥æ”¶ä¸åˆ°
  const interval = setInterval(() => {
    trySendMessage();
  }, 300);

  setTimeout(() => clearInterval(interval), 2000); // æœ€å¤šå‘é€ 2 ç§’



    // æ¥æ”¶æ¥è‡ª record.html çš„åˆ†æç»“æœ
    window.addEventListener('message', (event) => {
      console.log("record received");
      const msg = event.data.pluginMessage;
      if (msg?.type === 'analyze-transcript') {
        const { transcript, summary } = msg;
        resultBox.textContent = `ğŸ“ Transcript:\n${transcript}\n\nğŸ§  Summary:\n${summary}`;

        // å‘é€ç»™ Figma æ’ä»¶ code.ts æ’å…¥ç”»å¸ƒ
        parent.postMessage({
          pluginMessage: {
            type: 'analyze-transcript',
            transcript: msg.transcript,
            summary: msg.summary
          }
        }, '*');
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 16px; }
    #result { white-space: pre-wrap; background: #f2f2f2; padding: 12px; margin-top: 12px; height: 200px; overflow-y: auto; }
    button { padding: 8px 16px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>🎤 Analyze Meeting</h2>
  <button id="openBtn">Open Recorder</button>
  <div id="result">⏳ Waiting for result...</div>

  <script>
  const openBtn = document.getElementById('openBtn');
  const resultBox = document.getElementById('result');
  let recorderWindow = null;
  let ready = false;

  // 👆 点击打开 recorder.html
  openBtn.onclick = () => {
    recorderWindow = window.open(
      'https://fyp-2025-kath.vercel.app/record.html',
      '_blank',
      'width=500,height=400'
    );
    console.log("✅ Recorder window opened");
  };

  // 👂 监听所有来自 record.html 的消息
  window.addEventListener('message', (event) => {
    const msg = event.data;

    // ✅ Recorder 页面准备好了
    if (msg?.type === 'ready-to-record') {
      console.log('✅ Recorder ready, sending start signal...');
      ready = true;
      recorderWindow?.postMessage({ type: 'start-recording' }, '*');
    }

    // ✅ 收到分析结果
    if (msg?.pluginMessage?.type === 'analyze-transcript') {
      const { transcript, summary } = msg.pluginMessage;
      console.log('📥 Received transcript & summary');
      resultBox.textContent = `📝 Transcript:\n${transcript}\n\n🧠 Summary:\n${summary}`;

      // 转发给 code.ts 插件主线程
      parent.postMessage({
        pluginMessage: {
          type: 'analyze-transcript',
          transcript,
          summary
        }
      }, '*');
    }
  });
</script>
 
</body>
</html>

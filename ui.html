<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 16px; }
    #result { white-space: pre-wrap; background: #f2f2f2; padding: 12px; margin-top: 12px; height: 200px; overflow-y: auto; }
    button { padding: 8px 16px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>🎤 Analyze Meeting</h2>
  <button id="openBtn">Open Recorder</button>
  <div id="result">⏳ Waiting for result...</div>

  <script>
    const openBtn = document.getElementById('openBtn');
    const resultBox = document.getElementById('result');

    // 点击打开新窗口
    openBtn.onclick = () => {
      window.open('https://fyp-2025-kath.vercel.app/record.html', '_blank', 'width=500,height=400');
    };

    // 接收来自 record.html 的分析结果
    window.addEventListener('message', (event) => {
      console.log("record received");
      const msg = event.data.pluginMessage;
      if (msg?.type === 'analyze-transcript') {
        const { transcript, summary } = msg;
        resultBox.textContent = `📝 Transcript:\n${transcript}\n\n🧠 Summary:\n${summary}`;

        // 发送给 Figma 插件 code.ts 插入画布
        parent.postMessage({
          pluginMessage: {
            type: 'analyze-transcript',
            transcript,
            summary
          }
        }, '*');
      }
    });
  </script>
</body>
</html>
